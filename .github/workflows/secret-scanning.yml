name: Secret Scanning

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  detect-secrets:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install detect-secrets
        run: pip install detect-secrets

      - name: Scan for secrets
        run: |
          detect-secrets scan --all-files --force-use-all-plugins \
            --exclude-files 'package-lock.json|yarn.lock|poetry.lock' \
            > .secrets.baseline.tmp

      - name: Audit secrets
        run: |
          if [ -f .secrets.baseline ]; then
            detect-secrets audit .secrets.baseline.tmp
          fi

      - name: Fail if secrets detected
        run: |
          if grep -q '"results":' .secrets.baseline.tmp; then
            echo "âš ï¸ Potential secrets detected!"
            cat .secrets.baseline.tmp
            exit 1
          fi
