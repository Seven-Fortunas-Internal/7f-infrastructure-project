# Vulnerability Patch SLAs

## Overview
Seven Fortunas maintains strict Service Level Agreements (SLAs) for patching security vulnerabilities to ensure infrastructure security and SOC 2 compliance.

## SLA Policy

| Severity | Patch Window | Auto-Merge | Alert Channels |
|----------|-------------|------------|----------------|
| **Critical** | 24 hours | No (manual review) | Email, Matrix, GitHub Issue |
| **High** | 7 days | Yes (if tests pass) | Email, Matrix |
| **Medium** | 30 days | Yes | GitHub Issue |
| **Low** | 90 days | Yes | None |

## Automated Patching Workflow

### Dependabot Configuration
Dependabot automatically creates pull requests for vulnerability patches.

**Configuration:** `.github/dependabot.yml`

### Auto-Merge Workflow
GitHub Actions workflow automatically merges eligible patches based on severity.

**Workflow:** `.github/workflows/dependabot-auto-merge.yml`

**Auto-Merge Criteria:**
1. PR created by Dependabot
2. Severity is High, Medium, or Low (Critical requires manual review)
3. All CI checks pass
4. Within SLA window

### SLA Breach Warnings
Automated alerts when approaching SLA breach (80% of window elapsed):
- GitHub PR comment
- Email notification (for Critical/High)
- Matrix message (for Critical/High)

## Manual Review Process

### Critical Vulnerabilities (24-hour SLA)
1. Dependabot creates PR with "ðŸš¨ CRITICAL" label
2. GitHub Actions adds SLA warning comment
3. Security team (Jorge) reviews PR within 24 hours
4. Manual testing if needed
5. Merge and deploy

**Approval Required:** Yes (cannot auto-merge)

### High Vulnerabilities (7-day SLA)
1. Dependabot creates PR
2. Auto-merge if CI passes
3. Manual review if CI fails or complex changes

**Approval Required:** No (auto-merge enabled)

## Monthly Audit

### Purpose
Validate SLA compliance for SOC 2 and internal security policies.

### Process
```bash
# Run monthly audit
./scripts/monthly-vulnerability-sla-audit.sh
```

**Output:** `compliance/sla/audit-reports/vulnerability-sla-audit-TIMESTAMP.json`

### Audit Report Contents
- Open alerts by severity
- Patched alerts (last 30 days)
- SLA breaches count
- Compliance rate (%)
- Recommendations

### Compliance Target
**Target:** 100% SLA compliance (zero breaches)
**Acceptable:** â‰¥95% compliance (max 5% breaches with documented justification)

## SLA Metrics

### Tracked Metrics
1. **SLA Compliance Rate:** % of vulnerabilities patched within SLA
2. **Average Patch Time by Severity:** Mean time to patch by severity level
3. **SLA Breaches Count:** Number of vulnerabilities exceeding SLA window
4. **Auto-Merge Success Rate:** % of auto-merge PRs that succeeded
5. **Manual Intervention Rate:** % of patches requiring manual review

### Dashboard Integration
SLA metrics feed into:
- Security Dashboard (real-time monitoring)
- SOC 2 Compliance Dashboard (quarterly reports)
- Project Progress Dashboard (team visibility)

## Handling SLA Breaches

### When a Breach Occurs
1. **Immediate Action:** Patch the vulnerability as soon as possible
2. **Root Cause Analysis:** Document why breach occurred
3. **Process Improvement:** Update workflow to prevent future breaches
4. **SOC 2 Documentation:** Record breach in compliance log with remediation plan

### Common Breach Causes
- Dependency conflicts requiring manual resolution
- Complex breaking changes requiring code refactoring
- Test failures blocking auto-merge
- Holiday/weekend timing for Critical vulnerabilities

### Mitigation Strategies
- Monitor Dependabot alerts daily
- Enable Slack/Matrix notifications for Critical alerts
- Assign on-call rotation for Critical vulnerabilities
- Pre-approve low-risk patches for faster merging

## SOC 2 Integration

### Control: CC6.7 - Security Vulnerability Management
**Requirement:** Organization identifies, prioritizes, and remediates security vulnerabilities in a timely manner.

**Evidence:**
- SLA policy documentation (this document)
- Monthly audit reports (JSON files in `compliance/sla/audit-reports/`)
- GitHub Actions workflow logs (auto-merge activity)
- Dependabot alert history

### Audit Preparation
```bash
# Generate last 12 months of audit reports for SOC 2 audit
for i in {1..12}; do
    ./scripts/monthly-vulnerability-sla-audit.sh
    sleep 1  # Unique timestamp
done
```

## Troubleshooting

### Dependabot PR Not Auto-Merging
1. Check CI status: `gh pr checks PR_NUMBER`
2. Verify severity: `gh pr view PR_NUMBER --json labels`
3. Review workflow logs: GitHub Actions > Dependabot Auto-Merge
4. Manual merge if needed: `gh pr merge PR_NUMBER --squash`

### SLA Breach Alert Not Sent
1. Check GitHub Actions workflow permissions (write access required)
2. Verify email/Matrix integration configured
3. Review workflow logs for errors

### Audit Script Fails
1. Ensure GitHub CLI authenticated: `gh auth status`
2. Verify repository access: `gh repo view OWNER/REPO`
3. Check jq installed: `jq --version`

## Integration with Dependency Management (FR-5.2)

Vulnerability Patch SLAs integrate tightly with Dependency Vulnerability Management (FEATURE_020/FR-5.2):

**Dependency Detection:**
- Dependabot scans for vulnerabilities (FR-5.2)
- Creates PR for each vulnerability
- Passes to SLA workflow for patching

**SLA Enforcement:**
- This feature (NFR-1.2) enforces patch timing
- Auto-merge workflow applies SLA policy
- Monthly audit validates compliance

**Combined Workflow:**
1. Dependabot detects vulnerability (FR-5.2)
2. Creates PR with severity label
3. SLA workflow checks patch window (NFR-1.2)
4. Auto-merge if within SLA and tests pass
5. Alert if approaching breach
6. Monthly audit reports compliance

**Metrics Flow:**
- Dependabot: vulnerability count, severity distribution
- SLA Workflow: patch timing, compliance rate, breaches
- Dashboard: combined metrics for security posture

## References

- [Dependabot Documentation](https://docs.github.com/en/code-security/dependabot)
- [GitHub Actions Auto-Merge](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/incorporating-changes-from-a-pull-request/automatically-merging-a-pull-request)
- [SOC 2 CC6.7 Control](https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/aicpasoc2report)
- Seven Fortunas Dependency Management (FEATURE_020/FR-5.2)
- Seven Fortunas SOC 2 Preparation (FEATURE_022/FR-5.4)

---

**Last Updated:** 2026-02-17
**Owner:** Jorge (VP AI-SecOps)
**Review Cycle:** Monthly (with audit)
