# Vulnerability Patch SLAs

## Overview

Seven Fortunas maintains strict Service Level Agreements (SLAs) for patching security vulnerabilities based on severity.

**Framework:** NFR-1.2
**Implementation:** FR-5.2 (Dependabot + Auto-merge)

---

## SLA Targets

| Severity | Patch Window | Auto-Merge | Manual Review |
|----------|--------------|------------|---------------|
| **Critical** | 24 hours | âœ… Yes (if tests pass) | Required if tests fail |
| **High** | 7 days | âœ… Yes (if tests pass) | Required if tests fail |
| **Medium** | 30 days | âœ… Yes (if tests pass) | Recommended |
| **Low** | 90 days | âš ï¸ No | Required |

---

## Automated Patch Workflow

### Dependabot Configuration

**File:** `.github/dependabot.yml`

```yaml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "daily"
    open-pull-requests-limit: 10
    reviewers:
      - "Jorge"
    labels:
      - "dependencies"
      - "security"
```

### Auto-Merge Workflow

**File:** `.github/workflows/auto-merge-dependabot.yml`

**Triggers:**
- Dependabot PR created
- Severity: Critical or High
- All tests pass
- No merge conflicts

**Actions:**
1. Run CI/CD tests
2. If all pass â†’ Auto-merge
3. If any fail â†’ Notify Jorge, require manual review
4. If merge conflict â†’ Notify Jorge

**SLA Enforcement:**
- Critical: Merge within 24 hours or alert
- High: Merge within 7 days or alert
- Medium: Create reminder at 25 days
- Low: Create reminder at 80 days

---

## SLA Compliance Tracking

### Monthly Audit

**Schedule:** First Monday of each month

**Audit Process:**
```bash
# Run SLA compliance check
./scripts/check-vulnerability-sla-compliance.sh

# Output:
# Critical: 5 patched, 0 breached (100% compliance)
# High: 12 patched, 1 breached (92% compliance)
# Medium: 8 patched, 0 breached (100% compliance)
# Low: 15 patched, 2 breached (87% compliance)
```

**Audit Report:**
- Vulnerabilities patched on time
- SLA breaches (with root cause)
- Average patch time by severity
- Dependabot PR merge rate

### SLA Metrics

**Tracked Metrics:**
1. **Patch Time** - Time from vulnerability disclosure to patch deployment
2. **SLA Compliance Rate** - Percentage of vulnerabilities patched within SLA
3. **Auto-Merge Success Rate** - Percentage of Dependabot PRs auto-merged
4. **Manual Intervention Rate** - Percentage requiring manual review

**Calculation:**
```
SLA Compliance Rate = (Patched Within SLA / Total Vulnerabilities) Ã— 100%
Avg Patch Time = Sum(Patch Times) / Count(Vulnerabilities)
```

---

## SLA Breach Handling

### Critical Vulnerability Breach (>24 hours)

**Alert:** Immediate Slack notification + Email

**Escalation:**
1. **Hour 0-24:** Automated patching attempt
2. **Hour 24-26:** Slack alert to Jorge
3. **Hour 26-48:** Email escalation to leadership
4. **Hour 48+:** Incident report required

**Example Alert:**
```
ðŸš¨ CRITICAL SLA BREACH ðŸš¨

Vulnerability: CVE-2026-12345
Package: lodash@4.17.20
Severity: Critical (CVSS 9.8)
Disclosed: 2026-02-22 10:00 UTC
Current Time: 2026-02-23 11:00 UTC
Time Elapsed: 25 hours
SLA: 24 hours
Status: BREACH (1 hour overdue)

Action Required:
- Review Dependabot PR: #123
- Manual merge or document blocking issue
- Update incident log
```

### High Vulnerability Breach (>7 days)

**Alert:** Daily Slack reminder after day 5

**Process:**
1. **Day 0-5:** Automated patching + monitoring
2. **Day 5-7:** Daily reminder in #security channel
3. **Day 7+:** SLA breach logged, root cause analysis required

### Medium/Low Breach

**Alert:** Weekly digest of overdue patches

**Process:**
- Week before SLA: Reminder notification
- SLA breach: Log in monthly audit report
- No immediate escalation (unless accumulation)

---

## Root Cause Analysis

### Common SLA Breach Causes

1. **Test Failures** (40%)
   - Breaking changes in dependency
   - Mitigation: Pin major versions, improve test coverage

2. **Merge Conflicts** (25%)
   - Concurrent PRs from Dependabot
   - Mitigation: Daily merge schedule, rebase automation

3. **Breaking Changes** (20%)
   - API changes require code updates
   - Mitigation: Feature flags, staged rollouts

4. **Manual Review Required** (10%)
   - Complex security implications
   - Mitigation: Documented review process, faster turnaround

5. **Weekend/Holiday Timing** (5%)
   - No automated merge on weekends
   - Mitigation: Enable weekend auto-merge for Critical

### Improvement Actions

**Quarterly Review:**
- Analyze breach patterns
- Update automation rules
- Improve test coverage for common failure points
- Train team on faster manual review

---

## Integration with SOC 2 Compliance

### Controls Mapping

**Control:** CC6.8 - Vulnerability Management

**Evidence:**
- Monthly SLA compliance reports
- Automated patching workflows
- Manual audit logs
- Breach incident reports

**Audit Trail:**
```bash
# Export SLA compliance data for auditors
./scripts/export-sla-compliance-report.sh --year 2026 --format pdf

# Output: sla-compliance-2026.pdf
# - Monthly compliance rates
# - Breach incidents and root causes
# - Remediation actions taken
# - Process improvements implemented
```

---

## Monitoring and Alerts

### Real-Time Monitoring

**Dashboard:** `dashboards/security/vulnerability-sla-dashboard.html`

**Metrics Displayed:**
- Current open vulnerabilities by severity
- Time remaining until SLA breach
- Patch queue status
- Auto-merge success rate

**Alert Channels:**
- Slack: #security (real-time alerts)
- Email: security@sevenfortunas.dev (daily digest)
- Dashboard: Visual indicators (red/yellow/green)

### Alert Rules

```yaml
# Alert when Critical vulnerability discovered
- alert: CriticalVulnerabilityDiscovered
  condition: severity == "critical"
  action: immediate_slack_alert
  sla: 24h

# Alert when High vulnerability approaching SLA
- alert: HighVulnerabilitySLAWarning
  condition: severity == "high" AND time_remaining < 2d
  action: slack_reminder
  sla: 7d

# Alert when SLA breached
- alert: SLABreach
  condition: patch_time > sla_window
  action: escalation_email
  incident: required
```

---

## Best Practices

### Dependency Management

1. **Regular Updates**
   - Run Dependabot daily
   - Review and merge minor/patch updates weekly
   - Plan major version updates quarterly

2. **Testing Before Merge**
   - Require all tests to pass
   - Run security scans
   - Verify no breaking changes

3. **Staged Rollouts**
   - Test in staging environment first
   - Monitor production after merge
   - Rollback plan ready

### Manual Review Process

**When Required:**
- Critical vulnerability with test failures
- Breaking API changes
- Major version upgrades
- Multiple concurrent security updates

**Review Checklist:**
- [ ] Understand vulnerability impact
- [ ] Review dependency changelog
- [ ] Check for breaking changes
- [ ] Run full test suite locally
- [ ] Verify security fix effectiveness
- [ ] Document review decision

### Documentation

**Required Documentation:**
- SLA breach incident reports
- Root cause analysis for breaches
- Process improvement actions
- Monthly compliance summaries

---

## Troubleshooting

### Dependabot Not Creating PRs

**Symptoms:**
- No PRs from Dependabot for >7 days
- Known vulnerabilities not addressed

**Solution:**
```bash
# Check Dependabot configuration
gh api repos/OWNER/REPO/vulnerability-alerts

# Enable vulnerability alerts
gh api -X PUT repos/OWNER/REPO/vulnerability-alerts

# Trigger manual Dependabot run
gh api -X POST repos/OWNER/REPO/dependabot/secrets
```

### Auto-Merge Not Working

**Symptoms:**
- Dependabot PRs not auto-merging despite passing tests

**Solution:**
```bash
# Check workflow permissions
gh workflow view auto-merge-dependabot.yml

# Verify GITHUB_TOKEN permissions
# Required: contents: write, pull-requests: write

# Check workflow run logs
gh run list --workflow=auto-merge-dependabot.yml
```

### SLA Breach Alerts Not Sending

**Symptoms:**
- Vulnerability exceeds SLA without alert

**Solution:**
```bash
# Verify alert configuration
cat .github/workflows/sla-monitoring.yml

# Check Slack webhook
curl -X POST $SLACK_WEBHOOK_URL \
  -H 'Content-Type: application/json' \
  -d '{"text":"Test alert"}'

# Review workflow logs
gh run list --workflow=sla-monitoring.yml --limit 5
```

---

## See Also

- [FR-5.2: Dependency Vulnerability Management](../scripts/setup-dependabot.sh)
- [Dependabot Documentation](https://docs.github.com/en/code-security/dependabot)
- [SOC 2 Compliance Tracking](./soc2-compliance.md)
- [Security Dashboard](../../dashboards/security/README.md)

---

**Version:** 1.0
**Last Updated:** 2026-02-24
**Owner:** Jorge (VP AI-SecOps)
**Next Audit:** First Monday of next month
